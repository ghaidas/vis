


<!DOCTYPE html>
<html>
	<head>
 	<meta charset="UTF-8">		
		

    <title>project 1</title>
<style type="text/css">
    /*  Reset CSS
        http://meyerweb.com/eric/tools/css/reset/
        v2.0 | 20110126
        License: none (public domain)
    */

    html, body, div, span, applet, object, iframe,
    h1, h2, h3, h4, h5, h6, p, blockquote, pre,
    a, abbr, acronym, address, big, cite, code,
    del, dfn, em, img, ins, kbd, q, s, samp,
    small, strike, strong, sub, sup, tt, var,
    b, u, i, center,
    dl, dt, dd, ol, ul, li,
    fieldset, form, label, legend,
    table, caption, tbody, tfoot, thead, tr, th, td,
    article, aside, canvas, details, embed,
    figure, figcaption, footer, header, hgroup,
    menu, nav, output, ruby, section, summary,
    time, mark, audio, video {
        margin: 0;
        padding: 0;
        border: 0;
        font-size: 100%;
        font: inherit;
        vertical-align: baseline;
    }
    /* HTML5 display-role reset for older browsers */
    article, aside, details, figcaption, figure,
    footer, header, hgroup, menu, nav, section {
        display: block;
    }
    body {
        line-height: 1;
    }
    ol, ul {
        list-style: none;
    }
    blockquote, q {
        quotes: none;
    }
    blockquote:before, blockquote:after,
    q:before, q:after {
        content: '';
        content: none;
    }
    table {
        border-collapse: collapse;
        border-spacing: 0;
    }

    /* Custom Styles */

    body {
        background: #edf5f4;
        font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;
    }

    header {
        background: #58bbb3;
        background: -moz-linear-gradient(left,  #58bbb3 0%, #40adcf 100%);
        background: -webkit-linear-gradient(left,  #58bbb3 0%, #40adcf 100%);
        background: -o-linear-gradient(left,  #58bbb3 0%, #40adcf 100%);
        background: -ms-linear-gradient(left,  #58bbb3 0%, #40adcf 100%);
        background: linear-gradient(left,  #58bbb3 0%, #40adcf 100%);
        height: 84px;
        line-height: 84px;
        box-shadow: 0px 1px 1px rgba(0,0,0,0.1);
    }

    header h1 {
        color: white;
        text-align: center;
        font-weight: bold;
        font-size: 24px;
        text-shadow: 0px 1px 0px rgba(0,0,0,0.1);
    }

    p {
        margin: 10 auto;
    }

    #graph {
        margin: 50px auto;
        padding: 20px;
        
       
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        
    }

    #graph #info {
        text-align: right;
    }

    #graph #info #keys .key {
        padding: 10px;
        display: inline-block;
    }

    #info {
        color: #555;
    }

    #info #keys .key-text {
        vertical-align: super;
    }
    	
    
    .axis path,
    .axis line {
      fill: none;
      stroke: #000;
      shape-rendering: crispEdges;
    }
    
    .x.axis path {
      display: none;
    }
    
    .line {
      fill: none;
      stroke: steelblue;
      stroke-width: 1.5px;
    }
	.slice text {
            font-size: 8pt;
            font-family: Arial;
        }  

        
    </style>
	</head>

	<body>
 <header>
        <h1>Data Visualization of John Snow's Map</h1>
    </header>
<div id="graph">
        <div id="info">
            <div id="keys">
                 <p>
                    <span class="key-text">Female, 0-10</span>
                    <span class="key" id="fzero-key"></span>
                
               </p>
                  <p>   
                  <span class="key-text">Female, 11-20</span>
                    <span class="key" id="ftwinty-key"></span>
                
                </p>
                 <p>
                    <span class="key-text">Female, 21-40</span>
                    <span class="key" id="ffouty-key"></span>
               
                </p>
                 <p>
                    <span class="key-text">Female, 41-60</span>
                    <span class="key" id="fsixty-key"></span>
                </p>    
                <p>
                    <span class="key-text">Female, 61-80</span>
                    <span class="key" id="feighty-key"></span>
                </p>
                 <p>
                    <span class="key-text">Female, >80</span>
                    <span class="key" id="fup-key"></span>
                </p>    
                <p>
                    <span class="key-text">male, 0-10</span>
                    <span class="key" id="mzero-key"></span>
                </p>
                <p>
                    <span class="key-text">male, 11-20</span>
                    <span class="key" id="mtwinty-key"></span>
                 </p>
                  <p>
               
                    <span class="key-text">male, 21-40</span>
                    <span class="key" id="mfouty-key"></span>
               </p>
                <p>
                
                    <span class="key-text">male, 41-60</span>
                    <span class="key" id="msixty-key"></span>
                </p>
                 <p>
                    <span class="key-text">male, 61-80</span>
                    <span class="key" id="meighty-key"></span>
                </p>
                 <p>
                    <span class="key-text">male, >80</span>
                    <span class="key" id="mup-key"></span>
                </p>
                 <p>
                    <span class="key-text">Pumps</span>
                    <span class="key" id="Pumps-key"></span>
                </p>

            </div>
            <div id="current-data">
              
            </div>
        </div>
    </div>

	<svg height="700" width="700"></svg>
 	<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
		<script type="text/javascript">

	var streetData = d3.csv("streets.csv", function(data) {
	streetData = data;

	//Width and height
	var w = 1700;
	var h = 1700;
	var padding = 50;
			
	// data
	var i = 1;
	var temDataArray = [];
	var mainStreetData= [];
	var coordinates=[];

	d3.select("#fzero-key")
            .style('background', '#bcbddc');


        d3.select("#ftwinty-key")
            .style('background', '#9e9ac8');
    
    d3.select("#ffouty-key")
            .style('background', '#807dba');


        d3.select("#fsixty-key")
            .style('background', '#6a51a3');

d3.select("#feighty-key")
            .style('background', '#54278f');


        d3.select("#fup-key")
            .style('background', '#3f007d');

d3.select("#mzero-key")
            .style('background', '#a1d99b');


        d3.select("#mtwinty-key")
            .style('background', '#74c476');
    
    d3.select("#mfouty-key")
            .style('background', '#41ab5d');


        d3.select("#msixty-key")
            .style('background', '#238b45');

d3.select("#meighty-key")
            .style('background', '#006d2c');


        d3.select("#mup-key")
            .style('background', '#00441b');
 
 d3.select("#Pumps-key")
            .style('background', '#cb181d');



	streetData.forEach(function(d) {
		d.X = +d.X;
		d.Y = +d.Y;
		});

	console.log(streetData[0].Y);

	while (i < streetData.length){

		if (streetData[i].X % 1 === 0 && streetData[i].Y % 1 === 0) {

			mainStreetData.push(temDataArray);
			temDataArray = [];

		} else {
			
			temDataArray.push({x: streetData[i].X , y: streetData[i].Y});

		}
			i++;
	}



	
		// drawing the streets 
		 var lineFunction = d3.svg.line()
   			.x(function(d) { return xScale(d.x); })
   			.y(function(d) { return yScale(d.y); })
   			.interpolate("linear");


   			var xScale = d3.scale.linear()
  		 	 .domain([0, 70])
   			 .range([0, w]);
   			 var yScale = d3.scale.linear()
   	 	   	.domain([0, 70])
  			  .range([0, h]);

   			var svg = d3.select("svg")

   			
			for (var z = 0; z < mainStreetData.length; z++) {
        	 svg.append("path")
                .style("fill", "none")
                .style("stroke", "black")
                .style("stroke-width", 2)

                .attr("d",lineFunction(mainStreetData[z]));
                //console.log(mainStreetData[z]);
                	
                }
    // locations of the 13  pumps
	var pumpData = d3.csv("pumpsNew.csv", function(data) {
	pumpData = data;
	console.log(pumpData);
            

	var svgContainer = d3.select("svg")
                     .attr("width", 500)
                     .attr("height", 500);
 
 	var circles = svgContainer.selectAll("circle")
                      .data(pumpData)
                      .enter()
                      .append("circle");

	
	var circleAttributes = circles
                    .attr("cx", function (d) { return xScale(d.X); })
                    .attr("cy", function (d) { return yScale(d.Y); })
                    .attr("r", 7 )
                    .style("fill", "#cb181d")
                 	.on("mouseover", function(){d3.select(this)
                      .transition()                      
                      .duration(1000)
                      .attr("r", 28);})
                      .on("mouseout", function(){d3.select(this)
                      .transition()                      
                      .duration(1000)
                      .attr("r", 7);})
});


 // locations of the age, f,m ,deathes on the map
	var deathesMap = d3.csv("deaths.age.mf.csv", function(data) {
	deathesMap = data;
	console.log(deathesMap);
            

var height = 800,
    width = 500;

    var padding = 50;


    var viz = d3.select("#viz-wrapper")
                    .append('svg')
                    .attr('height', height + padding * 2 )
                    .attr('width', width + padding * 2)
                    .append('g')
                    .attr('id', 'viz')
                    .attr('transform', 
                      'translate(' + padding + ',' + padding + ')');

	var rScale = d3.scale.linear()
                          .range([5, 50]); 

	var svgContainer = d3.select("svg")
                     .attr("width", 500)
                     .attr("height", 500);
 
 	var circles = svgContainer.selectAll("circle")
                      .data(deathesMap)
                      .enter()
                      .append("circle")
                      .attr("class", "circle");
	
	var circleAttributes = circles
                    .attr("cx", function (d) { return xScale(d.X); })
                    .attr("cy", function (d) { return yScale(d.Y); })
                    .attr("r", 2.5 )
                    .attr("class", "circleAttributes")
                    .on("mouseover", function(){d3.select(this)
                      .transition()                      
                      .duration(1000)
                      .attr("r", 28);})
                      .on("mouseout", function(){d3.select(this)
                      .transition()                      
                      .duration(1000)
                      .attr("r", 2.5);})
                  
                    .style("fill", function(d) {
                         var returnColor;
                         if (d.fm == 1 && d.age == 5) { returnColor = "#3f007d";
                         } else if (d.fm == 1 && d.age == 4) { returnColor = "#54278f";
                         } else if (d.fm == 1 && d.age == 3) { returnColor = "#6a51a3";
                         } else if (d.fm == 1 && d.age == 2) { returnColor = "#807dba";
                         } else if (d.fm == 1 && d.age == 1) { returnColor = "#9e9ac8";
                     	 } else if (d.fm == 1 && d.age == 0) { returnColor = "#bcbddc";
                     	 } else if (d.fm == 0 && d.age == 5) { returnColor = "#00441b";
                     	 } else if (d.fm == 0 && d.age == 4) { returnColor = "#006d2c";
                     	 } else if (d.fm == 0 && d.age == 3) { returnColor = "#238b45";
                     	 } else if (d.fm == 0 && d.age == 2) { returnColor = "#41ab5d";
                     	 } else if (d.fm == 0 && d.age == 1) { returnColor = "#74c476";
                     	 } else if (d.fm == 0 && d.age == 0) { returnColor = "#a1d99b";
                     	 } 
                         return returnColor;
                      });




                 
});


		});


// ****************//
// ****TIMELINE****//
//*****************//
// credit to https://bl.ocks.org/larsenmtl/e3b8b7c2ca4787f77d78f58d41c3da91

// rearrange the data
 var myData = "date	Deaths \n\
19730819	1		\n\
19730820	1		\n\
19730821	1		\n\
19730822	0		\n\
19730823	1		\n\
19730824	1		\n\
19730825	0		\n\
19730826	1		\n\
19730827	1		\n\
19730828	1		\n\
19730829	1		\n\
19730830	8		\n\
19730831	56		\n\
19730901	143		\n\
19730902	116		\n\
19730903	54		\n\
19730904	46		\n\
19730905	36		\n\
19730906	20		\n\
19730907	28		\n\
19730908	12		\n\
19730909	11		\n\
19730910	5		\n\
19730911	5		\n\
19730912	1		\n\
19730913	3		\n\
19730914	0		\n\
19730915	1		\n\
19730916	4		\n\
19730917	2		\n\
19730918	3		\n\
19730919	0		\n\
19730920	0		\n\
19730921	2		\n\
19730922	1		\n\
19730923	1		\n\
19730924	1		\n\
19730925	1		\n\
19730926	1		\n\
19730927	1		\n\
19730928	0		\n\
19730929	0		\n";

    var margin = {
        top: 20,
        right: 80,
        bottom: 200,
        left: 50
      },
      widthTimeline = 900 - margin.left - margin.right,
      heightTimeline = 500 - margin.top - margin.bottom;

    var parseDate = d3.time.format("%Y%m%d").parse;

    var x = d3.time.scale()
      .range([0, widthTimeline]);

    var y = d3.scale.linear()
      .range([heightTimeline, 0]);

    var color = d3.scale.category10();

    var xAxis = d3.svg.axis()
      .scale(x)
      .orient("bottom");

    var yAxis = d3.svg.axis()
      .scale(y)
      .orient("left");

    var line = d3.svg.line()
      .interpolate("basis")
      .x(function(d) {
        return x(d.date);
      })
      .y(function(d) {
        return y(d.Deaths);
      });

    var svg = d3.select("body").append("svg")
      .attr("width", widthTimeline + margin.left + margin.right)
      .attr("height", heightTimeline + margin.top + margin.bottom)
      .append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    var data = d3.tsv.parse(myData);

    color.domain(d3.keys(data[0]).filter(function(key) {
      return key !== "date";
    }));

    data.forEach(function(d) {
      d.date = parseDate(d.date);
    });

    var deathsTimeline = color.domain().map(function(name) {
      return {
        name: name,
        values: data.map(function(d) {
          return {
            date: d.date,
            Deaths: +d[name]
          };
        })
      };
    });

    x.domain(d3.extent(data, function(d) {
      return d.date;
    }));

    y.domain([
      d3.min(deathsTimeline, function(c) {
        return d3.min(c.values, function(v) {
          return v.Deaths;
        });
      }),
      d3.max(deathsTimeline, function(c) {
        return d3.max(c.values, function(v) {
          return v.Deaths;
        });
      })
    ]);

    var legend = svg.selectAll('g')
      .data(deathsTimeline)
      .enter()
      .append('g')
      .attr('class', 'legend');

    legend.append('rect')
      .attr('x', widthTimeline - 20)
      .attr('y', function(d, i) {
        return i * 20;
      })
      .attr('width', 10)
      .attr('height', 10)
      .style('fill', function(d) {
        return color(d.name);
      });

    legend.append('text')
      .attr('x', widthTimeline - 8)
      .attr('y', function(d, i) {
        return (i * 20) + 9;
      })
      .text(function(d) {
        return d.name;
      });

    svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + heightTimeline + ")")
      .call(xAxis);

    svg.append("g")
      .attr("class", "y axis")
      .call(yAxis)
      .append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 6)
      .attr("dy", ".71em")
      .style("text-anchor", "end")
      .text(" Number of deaths");

    var deathLine = svg.selectAll(".deathLine")
      .data(deathsTimeline)
      .enter().append("g")
      .attr("class", "deathLine");

    deathLine.append("path")
      .attr("class", "line")
      .attr("d", function(d) {
        return line(d.values);
      })
      .style("stroke", function(d) {
        return color(d.name);
      });

    deathLine.append("text")
      .datum(function(d) {
        return {
          name: d.name,
          value: d.values[d.values.length - 1]
        };
      })
      .attr("transform", function(d) {
        return "translate(" + x(d.value.date) + "," + y(d.value.Deaths) + ")";
      })
      .attr("x", 3)
      .attr("dy", ".35em")
      .text(function(d) {
        return d.name;
      });

    var mouseG = svg.append("g")
      .attr("class", "mouse-over-effects");

    mouseG.append("path") // this is the black vertical line to follow mouse
      .attr("class", "mouse-line")
      .style("stroke", "black")
      .style("stroke-width", "1px")
      .style("opacity", "0");
      
    var lines = document.getElementsByClassName('line');

    var mousePerLine = mouseG.selectAll('.mouse-per-line')
      .data(deathsTimeline)
      .enter()
      .append("g")
      .attr("class", "mouse-per-line");

    mousePerLine.append("circle")
      .attr("r", 7)
      .style("stroke", function(d) {
        return color(d.name);
      })
      .style("fill", "none")
      .style("stroke-width", "1px")
      .style("opacity", "0");

    mousePerLine.append("text")
      .attr("transform", "translate(10,3)");

    mouseG.append('svg:rect') // append a rect to catch mouse movements on canvas
      .attr('width', widthTimeline) // can't catch mouse events on a g element
      .attr('height', heightTimeline)
      .attr('fill', 'none')
      .attr('pointer-events', 'all')
      .on('mouseout', function() { // on mouse out hide line, circles and text
        d3.select(".mouse-line")
          .style("opacity", "0");
        d3.selectAll(".mouse-per-line circle")
          .style("opacity", "0");
        d3.selectAll(".mouse-per-line text")
          .style("opacity", "0");
      })

      /// ????????????????????????????????????????????????????????????????
          //.on("mouseon", function(d) { 
        	//var currentIndex = d3.mouse(this);
			//d3.select(".circleAttributes").selectAll(".circle")
			//.attr("fill", function(d,i){ if (i == currentIndex) return highlightColor} else {return originalColor})
				
			//.on("mouseout", function(){
			//	d3.select(".svgContainer").selectAll(".circle")
              //        .transition()                      
                //      .duration(1000)
                  //    .attr("r", 2.5);})
					//	 .style("fill", function(d) {
                    //     var returnColor;
                    //     if (d.fm == 1 && d.age == 5) { returnColor = "#3f007d";
                    //     } else if (d.fm == 1 && d.age == 4) { returnColor = "#54278f";
                    //     }else if (d.fm == 1 && d.age == 3) { returnColor = "#6a51a3";
                    //     } else if (d.fm == 1 && d.age == 2) { returnColor = "#807dba";
                    //     } else if (d.fm == 1 && d.age == 1) { returnColor = "#9e9ac8";
                   //  	 } else if (d.fm == 1 && d.age == 0) { returnColor = "#bcbddc";
                   //  	 } else if (d.fm == 0 && d.age == 5) { returnColor = "#00441b";
                   //  	 } else if (d.fm == 0 && d.age == 4) { returnColor = "#006d2c";
                   //  	 } else if (d.fm == 0 && d.age == 3) { returnColor = "#238b45";
                   //  	 } else if (d.fm == 0 && d.age == 2) { returnColor = "#41ab5d";
                   //  	 } else if (d.fm == 0 && d.age == 1) { returnColor = "#74c476";
                   //  	 } else if (d.fm == 0 && d.age == 0) { returnColor = "#a1d99b";
                   //  	 } 
                   //      return returnColor;
                   //   });

      .on('mouseover', function() { // on mouse in show line, circles and text
        d3.select(".mouse-line")
          .style("opacity", "1");
        d3.selectAll(".mouse-per-line circle")
          .style("opacity", "1");
        d3.selectAll(".mouse-per-line text")
          .style("opacity", "1");
          
      })
      .on('mousemove', function() { // mouse moving over canvas
        var mouse = d3.mouse(this);
        d3.select(".mouse-line")
          .attr("d", function() {
            var d = "M" + mouse[0] + "," + heightTimeline;
            d += " " + mouse[0] + "," + 0;
            return d;
          });

        d3.selectAll(".mouse-per-line")
          .attr("transform", function(d, i) {
            console.log(widthTimeline/mouse[0])
            var xDate = x.invert(mouse[0]),
                bisect = d3.bisector(function(d) { return d.date; }).right;
                idx = bisect(d.values, xDate);
            
            var beginning = 0,
                end = lines[i].getTotalLength(),
                target = null;

            while (true){
              target = Math.floor((beginning + end) / 2);
              pos = lines[i].getPointAtLength(target);
              if ((target === end || target === beginning) && pos.x !== mouse[0]) {
                  break;
              }
              if (pos.x > mouse[0])      end = target;
              else if (pos.x < mouse[0]) beginning = target;
              else break; //position found
            }
            
            d3.select(this).select('text')
              .text(y.invert(pos.y).toFixed(2));
              
            return "translate(" + mouse[0] + "," + pos.y +")";
          });
      });

 // ****************//
// ****Age & deaths pie chart ****//
//*****************//
// credit to http://bl.ocks.org/enjalot/1203641
  

    var wPieAge = 500,                        
    hPieAge = 500,                            
    rPieAge = 100,                            
    colorPieAge = d3.scale.category20c();     

    ageDeathData = [{"label":"0-10", "value":143}, 
            {"label":"11-20", "value":48}, 
            {"label":"21-40", "value":58},
            {"label":"41-60", "value":57},
            {"label":"61-80", "value":90},
            {"label":">80", "value":173}];
    
    var vis = d3.select("body")
        .append("svg:svg")              
        .data([ageDeathData])                   
            .attr("width", wPieAge)           
            .attr("height", hPieAge)
        .append("svg:g")                
            .attr("transform", "translate(" + rPieAge + "," + rPieAge + ")")     

    var arc = d3.svg.arc()              
        .outerRadius(rPieAge);

    var pie = d3.layout.pie()           
        .value(function(d) { return d.value; });     

    var arcs = vis.selectAll("g.slice")     
        .data(pie)                          
        .enter()                            
        .append("svg:g")                
        .attr("class", "slice");    

        arcs.append("svg:path")
                .attr("fill", function(d, i) { return color(i); } ) 
                .attr("d", arc);                                    

        arcs.append("svg:text")                                     
                .attr("transform", function(d) {                    
                d.innerRadius = 0;
                d.outerRadius = rPieAge;
                return "translate(" + arc.centroid(d) + ")";        
            })
            .attr("text-anchor", "middle")                          
            .text(function(d, i) { return ageDeathData[i].label; });        
        
 // ****************//
// ****F,M & deaths pie chart ****//
//*****************//
// credit to http://bl.ocks.org/enjalot/1203641
    var w = 500,                        
    h = 500,                            
    r = 100,                            
    color = d3.scale.category20c();     

    ageDeathData = [{"label":"Male Deaths", "value":310}, 
                   {"label":"Female Deaths", "value":261}];
    
    var vis = d3.select("body")
        .append("svg:svg")              
        .data([ageDeathData])                   
            .attr("width", w)           
            .attr("height", h)
        .append("svg:g")                
            .attr("transform", "translate(" + r + "," + r + ")")   
          
            
     

    var arc = d3.svg.arc()              
        .outerRadius(r);

    var pie = d3.layout.pie()           
        .value(function(d) { return d.value; });     

    var arcs = vis.selectAll("g.slice")     
        .data(pie)                          
        .enter()                            
        .append("svg:g")                
        .attr("class", "slice");    

        arcs.append("svg:path")
                .attr("fill", function(d, i) { return color(i); } ) 
                .attr("d", arc);                                    

        arcs.append("svg:text")                                     
                .attr("transform", function(d) {                    
                d.innerRadius = 0;
                d.outerRadius = r;
                return "translate(" + arc.centroid(d) + ")";        
            })
            .attr("text-anchor", "middle")                          
            .text(function(d, i) { return ageDeathData[i].value  + " "+ ageDeathData[i].label; });     



		 
		</script>
	</body>
</html>
